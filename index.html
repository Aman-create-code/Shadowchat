<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0b141a">
    <meta name="description" content="ShadowChat Ultimate V12">
    <title>ShadowChat Ultimate V12</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        wa: { 
                            light: '#ffffff', 
                            dark: '#111b21', 
                            panelLight: '#f0f2f5',
                            panel: '#202c33',
                            accent: '#00a884', 
                            accentHover: '#008f6f',
                            bubbleOut: '#d9fdd3', 
                            bubbleIn: '#ffffff', 
                            bubbleDarkOut: '#005c4b', 
                            bubbleDarkIn: '#202c33',
                            iosRed: '#ff3b30',
                            iosGreen: '#34c759',
                            system: '#182229'
                        }
                    },
                    fontFamily: {
                        sans: ['SF Pro Display', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                        mono: ['SF Mono', 'Fira Code', 'Roboto Mono', 'monospace'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.32, 0.72, 0, 1) forwards',
                        'slide-down': 'slideDown 0.3s cubic-bezier(0.32, 0.72, 0, 1) forwards',
                        'pulse-fast': 'pulse 1.5s infinite',
                        'fade-in': 'fadeIn 0.2s ease-out forwards',
                        'scale-in': 'scaleIn 0.15s ease-out forwards',
                    },
                    keyframes: {
                        slideUp: { '0%': { transform: 'translateY(100%)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        slideDown: { '0%': { transform: 'translateY(-20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        scaleIn: { '0%': { transform: 'scale(0.9)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" href="style.css">
</head>
<body class="text-gray-900 dark:text-gray-100 flex flex-col md:flex-row h-[100dvh] overflow-hidden select-none">

    <div id="audioContainer" class="hidden">
        <audio id="remoteAudio" autoplay playsinline></audio>
        <audio id="localAudio" muted autoplay playsinline></audio>
        <audio id="sfxRingIncoming" loop preload="auto" src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_0dc2e816a7.mp3"></audio>
        <audio id="sfxRingOutbound" loop preload="auto" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0c7443c.mp3"></audio>
        <audio id="sfxMessage" preload="auto" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_bb630cc098.mp3"></audio>
    </div>

    <div id="notifRequestBanner" class="hidden fixed top-0 left-0 w-full z-[9999] bg-wa-accent text-white p-3 shadow-lg animate-slide-down flex justify-between items-center px-6">
        <div class="flex items-center gap-3">
            <i data-lucide="bell-ring" class="w-5 h-5 animate-pulse"></i>
            <span class="text-sm font-bold">Benachrichtigungen aktivieren?</span>
        </div>
        <div class="flex gap-3">
            <button onclick="window.dismissNotif()" class="text-xs font-medium hover:underline opacity-80">Später</button>
            <button onclick="window.enableNotif()" class="bg-white text-wa-accent px-3 py-1 rounded-full text-xs font-bold hover:bg-gray-100 transition">Aktivieren</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <div id="lightbox" class="fixed inset-0 z-[300] bg-black/95 flex flex-col items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <button onclick="window.closeLightbox()" class="absolute top-4 right-4 p-2 text-gray-400 hover:text-white bg-black/50 rounded-full z-50"><i data-lucide="x" class="w-8 h-8"></i></button>
        <img id="lightbox-img" class="max-h-[90dvh] max-w-[95vw] object-contain shadow-2xl rounded-sm transition-transform duration-200">
    </div>

    <div id="contextMenu" class="hidden fixed z-[500] bg-white dark:bg-wa-panel rounded-xl shadow-2xl w-48 py-2 border dark:border-gray-700 animate-scale-in origin-top-left">
        <button id="ctx-reply" class="w-full text-left px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-white/5 text-sm flex items-center gap-3"><i data-lucide="reply" class="w-4 h-4 text-gray-500"></i> Antworten</button>
        <button id="ctx-copy" class="w-full text-left px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-white/5 text-sm flex items-center gap-3"><i data-lucide="copy" class="w-4 h-4 text-gray-500"></i> Kopieren</button>
        <div class="h-[1px] bg-gray-200 dark:bg-gray-700 my-1"></div>
        <button id="ctx-delete" class="w-full text-left px-4 py-2.5 hover:bg-gray-100 dark:hover:bg-white/5 text-sm flex items-center gap-3 text-red-500"><i data-lucide="trash-2" class="w-4 h-4"></i> Löschen</button>
    </div>

    <aside id="mainSidebar" class="flex flex-col w-full md:w-[380px] lg:w-[420px] h-full border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-wa-dark z-20 shrink-0 overflow-hidden transition-all duration-300">
        <header class="h-[64px] bg-wa-panelLight dark:bg-wa-panel flex items-center justify-between px-4 shrink-0 shadow-sm z-20">
            <div class="flex items-center gap-3 group cursor-pointer select-none" onclick="window.switchTab('settings')">
                <div class="relative">
                    <div id="myAvatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-wa-accent to-emerald-600 flex items-center justify-center font-bold text-white text-lg shadow-lg">?</div>
                    <div id="myConnStatus" class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-wa-panelLight dark:border-wa-panel"></div>
                </div>
                <div class="hidden sm:block">
                    <p class="font-bold text-sm leading-none dark:text-gray-100" id="myDisplayNick">Lädt...</p>
                    <p class="text-[10px] text-wa-accent font-bold mt-1 tracking-wide">ULTIMATE V12</p>
                </div>
            </div>
            <div class="flex items-center gap-1.5 text-gray-600 dark:text-gray-400">
                <button onclick="window.switchTab('status')" class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition"><i data-lucide="circle-dashed" class="w-5 h-5"></i></button>
                <button onclick="window.toggleModal('newGroupModal')" class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition"><i data-lucide="message-square-plus" class="w-5 h-5"></i></button>
                <div class="relative group">
                    <button class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition"><i data-lucide="more-vertical" class="w-5 h-5"></i></button>
                    <div class="absolute right-0 top-full mt-2 w-48 bg-white dark:bg-wa-panel rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 hidden group-hover:block z-50 py-1 origin-top-right animate-scale-in">
                        <button onclick="window.switchTab('settings')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-white/5 text-sm">Einstellungen</button>
                        <button onclick="window.toggleModal('joinGroupModal')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-white/5 text-sm">Gruppe beitreten</button>
                        <button onclick="window.toggleTheme()" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-white/5 text-sm flex items-center gap-2">Theme wechseln</button>
                        <div class="border-t dark:border-gray-700 my-1"></div>
                        <button onclick="window.toggleModal('loginModal')" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-white/5 text-sm text-red-400">Account wechseln</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="p-2 bg-white dark:bg-wa-dark border-b dark:border-gray-800 z-10">
            <div class="bg-gray-100 dark:bg-wa-panel flex items-center px-4 py-2 rounded-lg transition-all focus-within:ring-1 ring-wa-accent focus-within:bg-white dark:focus-within:bg-wa-panel">
                <i data-lucide="search" class="w-4 h-4 text-gray-400 transition-colors group-focus-within:text-wa-accent"></i>
                <input id="searchInput" type="text" placeholder="Suchen..." class="bg-transparent text-sm w-full outline-none px-3 py-0.5 placeholder-gray-500 dark:text-white" onkeyup="window.filterChats()">
            </div>
        </div>

        <div class="hidden md:flex justify-around border-b dark:border-gray-800 bg-white dark:bg-wa-dark p-1">
            <button onclick="window.switchTab('chats')" class="tab-btn flex-1 py-3 flex justify-center border-b-2 border-transparent relative hover:bg-gray-50 dark:hover:bg-white/5 transition active-tab" id="tabbtn-chats">
                <i data-lucide="message-square" class="w-5 h-5"></i>
                <span id="badge-chats" class="absolute -top-1 -right-1 hidden w-2 h-2 bg-wa-accent rounded-full animate-bounce"></span>
            </button>
            <button onclick="window.switchTab('friends')" class="tab-btn flex-1 py-3 flex justify-center border-b-2 border-transparent hover:bg-gray-50 dark:hover:bg-white/5 transition" id="tabbtn-friends">
                <div class="relative"><i data-lucide="users" class="w-5 h-5"></i><span id="badge-friends" class="absolute -top-1 -right-2 hidden w-2 h-2 bg-wa-iosRed rounded-full"></span></div>
            </button>
            <button onclick="window.switchTab('settings')" class="tab-btn flex-1 py-3 flex justify-center border-b-2 border-transparent hover:bg-gray-50 dark:hover:bg-white/5 transition" id="tabbtn-settings"><i data-lucide="settings" class="w-5 h-5"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto custom-scrollbar relative bg-white dark:bg-wa-dark">
            <div id="tab-chats" class="tab-content h-full">
                <div id="chatListContainer" class="divide-y divide-gray-100 dark:divide-gray-800/50 pb-20">
                    <div class="flex flex-col items-center justify-center h-40 text-gray-500 gap-2">
                        <div class="w-6 h-6 border-2 border-wa-accent border-t-transparent rounded-full animate-spin"></div>
                        <span class="text-xs">Lade Chats...</span>
                    </div>
                </div>
            </div>

            <div id="tab-friends" class="hidden tab-content p-4 space-y-6">
                <div class="bg-gradient-to-br from-wa-panel to-wa-dark p-5 rounded-2xl border border-gray-700 shadow-lg relative group">
                    <h4 class="text-xs font-bold text-wa-accent uppercase mb-3 flex items-center gap-2"><i data-lucide="user-plus" class="w-3 h-3"></i> Neuen Kontakt</h4>
                    <div class="flex gap-2">
                        <input id="friendSearchInput" type="text" class="flex-1 bg-black/20 text-white p-2.5 rounded-lg text-sm border border-gray-600 outline-none focus:border-wa-accent focus:ring-1 ring-wa-accent transition" placeholder="ID eingeben...">
                        <button onclick="window.sendRequest()" class="bg-wa-accent hover:bg-wa-accentHover text-white p-2.5 rounded-lg shadow-md transition-all active:scale-95"><i data-lucide="send" class="w-5 h-5"></i></button>
                    </div>
                </div>
                <div id="pendingContainer" class="hidden animate-slide-down">
                    <h4 class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-3 px-2 flex justify-between">Anfragen <span id="pendingCount" class="bg-orange-500/20 px-2 rounded-full">0</span></h4>
                    <div id="pendingList" class="space-y-2"></div>
                </div>
                <div>
                    <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-3 px-2">Meine Kontakte</h4>
                    <div id="contactsList" class="space-y-2 pb-20"></div>
                </div>
            </div>

            <div id="tab-status" class="hidden tab-content p-4">
                <div class="flex items-center gap-4 mb-8 cursor-pointer group p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-wa-panel transition" onclick="document.getElementById('stIn').click()">
                    <div class="relative">
                        <div class="w-14 h-14 rounded-full bg-gray-200 dark:bg-gray-800 flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-400 group-hover:border-wa-accent transition-colors">
                            <img id="myStatusPreview" class="w-full h-full object-cover hidden">
                            <i data-lucide="camera" class="text-gray-400 group-hover:text-wa-accent transition"></i>
                        </div>
                        <div class="absolute -bottom-1 -right-1 bg-wa-accent rounded-full p-1 border-4 border-white dark:border-wa-dark"><i data-lucide="plus" class="w-3 h-3 text-white"></i></div>
                    </div>
                    <div>
                        <h3 class="font-bold">Mein Status</h3>
                        <p class="text-xs text-gray-500">Tippe für neues Update</p>
                    </div>
                    <input type="file" id="stIn" class="hidden" accept="image/*" onchange="window.upStatus()">
                </div>
                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-4">Aktuelle Meldungen</h4>
                <div id="globalStatusList" class="space-y-3 pb-20"></div>
            </div>

            <div id="tab-settings" class="hidden tab-content p-6 space-y-8 animate-fade-in pb-20">
                <div class="text-center relative">
                    <div class="w-28 h-28 rounded-full bg-gradient-to-tr from-wa-accent to-blue-500 mx-auto flex items-center justify-center text-5xl font-black text-white shadow-2xl mb-4 ring-4 ring-white dark:ring-wa-panel relative" id="setAvatar">?</div>
                    <h2 class="text-2xl font-bold" id="setNick">Gast</h2>
                    <p class="text-xs text-gray-500 mt-1">ShadowChat V12 User</p>
                </div>
                <div class="space-y-5">
                    <div class="bg-gray-50 dark:bg-wa-panel p-5 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm">
                        <label class="text-[10px] font-bold text-wa-accent uppercase tracking-tighter flex items-center gap-2 mb-2"><i data-lucide="user" class="w-3 h-3"></i> Display Name</label>
                        <div class="flex gap-2">
                            <input id="nickIn" type="text" class="flex-1 bg-transparent border-b-2 border-gray-300 dark:border-gray-600 focus:border-wa-accent outline-none pb-2 text-sm font-medium transition-colors">
                            <button onclick="window.saveProfile()" class="bg-wa-accent text-white px-4 py-1 rounded-lg text-xs font-bold uppercase shadow hover:bg-wa-accentHover transition">Save</button>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-wa-panel p-5 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm">
                         <label class="text-[10px] font-bold text-wa-accent uppercase tracking-tighter flex items-center gap-2 mb-3"><i data-lucide="image" class="w-3 h-3"></i> Chat Hintergrund</label>
                         <div class="flex gap-2 overflow-x-auto pb-2 custom-scrollbar">
                             <div class="w-10 h-10 rounded-lg bg-[#efeae2] border-2 cursor-pointer hover:scale-110 transition shrink-0" onclick="window.setWallpaper('default')"></div>
                             <div class="w-10 h-10 rounded-lg bg-black border-2 cursor-pointer hover:scale-110 transition shrink-0" onclick="window.setWallpaper('#000000')"></div>
                             <div class="w-10 h-10 rounded-lg bg-[#111b21] border-2 cursor-pointer hover:scale-110 transition shrink-0" onclick="window.setWallpaper('#111b21')"></div>
                         </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-wa-panel p-5 rounded-2xl border border-gray-100 dark:border-gray-700 shadow-sm relative overflow-hidden">
                        <label class="text-[10px] font-bold text-gray-500 uppercase tracking-tighter mb-4 block flex items-center gap-1">Sicherheit</label>
                        <div class="mb-5 relative z-10">
                            <p class="text-xs text-gray-400 mb-1.5 flex justify-between">Deine ID <span class="text-[10px] text-wa-accent cursor-pointer" onclick="window.copyMyId()">KOPIEREN</span></p>
                            <p id="myFullId" class="font-mono text-[11px] bg-black/5 dark:bg-black/30 p-3 rounded-lg cursor-pointer select-all border border-gray-200 dark:border-gray-600 break-all" onclick="window.copyMyId()">---</p>
                        </div>
                        <div class="relative z-10">
                            <p class="text-xs text-gray-400 mb-1.5">Passwort</p>
                            <div class="flex gap-2 items-center">
                                <p id="mySecretPass" class="font-mono text-sm bg-red-500/10 text-red-500 p-2.5 rounded-lg flex-1 filter blur-[5px] hover:blur-0 transition cursor-pointer text-center font-bold">********</p>
                                <button onclick="document.getElementById('mySecretPass').classList.toggle('blur-[5px]')" class="p-2 text-gray-400 hover:text-white transition"><i data-lucide="eye" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <nav class="md:hidden h-[70px] bg-white dark:bg-wa-panel border-t dark:border-gray-800 flex justify-around items-center shrink-0 z-30 pb-safe">
            <button onclick="window.switchTab('chats')" class="m-nav-btn flex flex-col items-center gap-1 text-wa-accent transition active:scale-95 relative" id="mnav-chats">
                <i data-lucide="message-square" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">Chats</span>
                <span id="mnav-badge-chats" class="absolute top-0 right-2 w-2.5 h-2.5 bg-wa-accent rounded-full border-2 border-white dark:border-wa-panel hidden"></span>
            </button>
            <button onclick="window.switchTab('status')" class="m-nav-btn flex flex-col items-center gap-1 text-gray-500 transition active:scale-95" id="mnav-status"><i data-lucide="circle-dashed" class="w-6 h-6"></i><span class="text-[10px] font-bold">Status</span></button>
            <button onclick="window.switchTab('friends')" class="m-nav-btn flex flex-col items-center gap-1 text-gray-500 transition active:scale-95 relative" id="mnav-friends">
                <i data-lucide="users" class="w-6 h-6"></i>
                <span class="text-[10px] font-bold">Leute</span>
                <span id="mnav-badge-friends" class="absolute top-0 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-wa-panel hidden"></span>
            </button>
            <button onclick="window.switchTab('settings')" class="m-nav-btn flex flex-col items-center gap-1 text-gray-500 transition active:scale-95" id="mnav-settings"><i data-lucide="settings" class="w-6 h-6"></i><span class="text-[10px] font-bold">Profil</span></button>
        </nav>
    </aside>

    <main id="chatArea" class="hidden md:flex flex-1 flex-col h-full relative overflow-hidden bg-[#efeae2] dark:bg-wa-dark z-30 transition-all duration-300">
        <div id="chatBackground" class="absolute inset-0 opacity-[0.4] dark:opacity-[0.06] pointer-events-none z-0 transition-colors duration-500" style="background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-size: 400px; background-color: #efeae2;"></div>

        <header id="chatHeader" class="hidden h-[64px] bg-wa-panelLight dark:bg-wa-panel flex items-center justify-between px-4 shrink-0 z-10 border-b dark:border-gray-800 shadow-sm backdrop-blur-md bg-opacity-95">
            <div class="flex items-center gap-3">
                <button onclick="window.closeChatMobile()" class="md:hidden p-2 -ml-2 text-gray-500 hover:text-wa-accent transition"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
                <div id="activeAvatar" class="w-10 h-10 rounded-full bg-gray-400 flex items-center justify-center text-white font-bold shadow-sm cursor-pointer hover:opacity-80 transition" onclick="window.toggleModal('infoModal')">?</div>
                <div class="cursor-pointer" onclick="window.toggleModal('infoModal')">
                    <h2 id="activeTitle" class="font-bold text-sm md:text-base leading-tight dark:text-gray-100">Chat</h2>
                    <p id="activeSub" class="text-[11px] text-wa-accent font-medium truncate max-w-[150px] animate-fade-in flex items-center gap-1">Tippe für Info</p>
                </div>
            </div>
            <div class="flex items-center gap-2 md:gap-4">
                <button onclick="window.initiateCall()" class="p-2.5 text-wa-accent hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition shadow-sm bg-white dark:bg-transparent"><i data-lucide="phone" class="w-5 h-5 fill-current"></i></button>
                <button onclick="window.toggleModal('infoModal')" class="p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition"><i data-lucide="more-vertical" class="w-5 h-5"></i></button>
            </div>
        </header>

        <div id="messagesList" class="flex-1 overflow-y-auto p-4 md:px-8 lg:px-16 space-y-2 relative z-10 custom-scrollbar flex flex-col pb-4"></div>
        
        <button id="scrollDownBtn" onclick="window.scrollToBottom(true)" class="absolute bottom-20 right-5 z-20 bg-wa-panel text-wa-accent p-3 rounded-full shadow-lg scale-0 transition-transform duration-200 hover:bg-gray-700 border border-gray-700">
            <i data-lucide="chevron-down" class="w-5 h-5"></i>
            <span id="unreadScrollBadge" class="absolute -top-1 -right-1 bg-wa-iosGreen text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center hidden"></span>
        </button>

        <footer id="chatInputArea" class="hidden flex-col bg-wa-panelLight dark:bg-wa-panel shrink-0 z-20 border-t dark:border-gray-800">
            <div id="replyPreview" class="hidden bg-black/5 dark:bg-black/20 p-2 mx-2 mt-2 rounded-lg flex justify-between items-center border-l-4 border-wa-accent animate-slide-up">
                <div class="flex flex-col overflow-hidden px-2">
                    <span id="replyTargetName" class="text-xs font-bold text-wa-accent">User</span>
                    <span id="replyTargetText" class="text-xs text-gray-500 dark:text-gray-400 line-clamp-1">Nachricht...</span>
                </div>
                <button onclick="window.cancelReply()" class="p-1 hover:bg-black/10 rounded-full"><i data-lucide="x" class="w-4 h-4"></i></button>
            </div>
            <div id="attachmentPreview" class="hidden bg-wa-panelLight dark:bg-wa-panel p-3 border-b dark:border-gray-700 animate-slide-up">
                <div class="relative inline-block group">
                    <img id="prevImg" class="h-32 w-auto rounded-xl border-2 border-wa-accent shadow-lg object-cover">
                    <button onclick="window.clearAttachment()" class="absolute -top-2 -right-2 bg-gray-800 text-white rounded-full p-1 shadow-md hover:scale-110 transition"><i data-lucide="x" class="w-3 h-3"></i></button>
                </div>
            </div>
            <div class="p-2 md:p-3 flex items-end gap-2">
                <button onclick="document.getElementById('imgIn').click()" class="p-3 text-gray-500 hover:text-wa-accent transition rounded-full hover:bg-black/5 dark:hover:bg-white/5"><i data-lucide="plus" class="w-6 h-6"></i></button>
                <input type="file" id="imgIn" class="hidden" accept="image/*" onchange="window.handleFile()">
                <div class="flex-1 bg-white dark:bg-wa-dark rounded-2xl flex items-center px-4 py-2 min-h-[48px] shadow-sm ring-1 ring-transparent focus-within:ring-wa-accent/50 transition-all">
                    <button id="emojiBtn" class="mr-2 text-gray-400 hover:text-yellow-500 transition"><i data-lucide="smile" class="w-5 h-5"></i></button>
                    <textarea id="msgIn" placeholder="Nachricht schreiben..." class="w-full bg-transparent outline-none text-[15px] dark:text-white px-1 py-1 resize-none max-h-32 custom-scrollbar placeholder-gray-500" rows="1" oninput="window.handleInput(this)" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); window.sendMsg(); }"></textarea>
                </div>
                <button id="recordBtn" class="bg-wa-panel dark:bg-gray-700 text-wa-accent p-3.5 rounded-full shadow-lg hover:scale-105 active:scale-90 transition-all flex items-center justify-center" onmousedown="window.startRecording()" onmouseup="window.stopRecording()">
                    <i data-lucide="mic" class="w-5 h-5"></i>
                </button>
                <button id="sendBtn" onclick="window.sendMsg()" class="hidden bg-wa-accent text-white p-3.5 rounded-full shadow-lg hover:bg-wa-accentHover hover:scale-105 active:scale-90 transition-all flex items-center justify-center">
                    <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                </button>
            </div>
        </footer>
    </main>

    <div id="callOverlay" class="hidden fixed inset-0 z-[200] flex flex-col items-center justify-center py-12 px-6 bg-gray-900 text-white animate-fade-in overflow-hidden">
        <div class="absolute top-[-20%] left-[-20%] w-[80%] h-[80%] bg-purple-900/40 blur-[120px] rounded-full pointer-events-none"></div>
        <div class="absolute bottom-[-20%] right-[-20%] w-[80%] h-[80%] bg-wa-accent/30 blur-[120px] rounded-full pointer-events-none"></div>
        <div class="absolute inset-0 bg-black/40 backdrop-blur-3xl z-0"></div>
        <div class="relative z-10 w-full max-w-sm flex flex-col items-center h-full justify-between py-10">
            <div class="flex flex-col items-center gap-2 mt-8">
                <div class="flex items-center gap-2 text-gray-300 text-xs font-semibold px-4 py-1 rounded-full bg-white/5 border border-white/10">
                    <i data-lucide="lock" class="w-3 h-3 text-wa-accent"></i> <span>End-to-End Encrypted</span>
                </div>
                <h2 id="callName" class="text-3xl font-bold tracking-tight text-center mt-4">Unbekannt</h2>
                <p id="callStatus" class="text-base text-gray-400 font-medium animate-pulse">Verbinden...</p>
                <p id="callTimer" class="hidden font-mono text-xl tracking-widest text-gray-200 mt-2">00:00</p>
            </div>
            <div class="relative w-40 h-40 flex items-center justify-center my-8">
                <div id="callRipple" class="hidden absolute inset-0 rounded-full border border-white/30 animate-ping opacity-75"></div>
                <div class="absolute inset-0 bg-gradient-to-b from-gray-700 to-gray-800 rounded-full flex items-center justify-center shadow-2xl z-10">
                    <span id="callAvatar" class="text-6xl font-bold text-white">?</span>
                </div>
            </div>
            <div id="activeCallControls" class="hidden w-full animate-slide-up">
                <div class="grid grid-cols-4 gap-4 mb-10 px-2 place-items-center">
                    <button onclick="window.toggleMute()" id="btnMute" class="w-14 h-14 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition backdrop-blur-md"><i data-lucide="mic" class="w-6 h-6"></i></button>
                    <button class="w-14 h-14 rounded-full bg-white/10 opacity-50"><i data-lucide="video" class="w-6 h-6"></i></button>
                    <button onclick="window.toggleSpeaker()" id="btnSpeaker" class="w-14 h-14 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition backdrop-blur-md"><i data-lucide="volume-2" class="w-6 h-6"></i></button>
                    <button class="w-14 h-14 rounded-full bg-white/10 opacity-50"><i data-lucide="message-square" class="w-6 h-6"></i></button>
                </div>
                <button onclick="window.hangUpCall()" class="w-full bg-red-500 hover:bg-red-600 py-4 rounded-2xl shadow-xl flex items-center justify-center gap-2 font-bold transition transform active:scale-95"><i data-lucide="phone-off" class="w-6 h-6 fill-current"></i> Auflegen</button>
            </div>
            <div id="incomingCallControls" class="hidden w-full flex items-center justify-between px-4 animate-slide-up pb-8">
                <div class="flex flex-col items-center gap-2">
                    <button onclick="window.hangUpCall()" class="w-16 h-16 rounded-full bg-white/10 text-red-400 hover:text-red-500 flex items-center justify-center shadow-lg transition backdrop-blur-md border border-white/5"><i data-lucide="x" class="w-8 h-8"></i></button>
                    <span class="text-xs font-medium text-gray-400">Ablehnen</span>
                </div>
                <div class="flex flex-col items-center gap-2">
                    <button onclick="window.answerIncomingCall()" class="w-20 h-20 rounded-full bg-wa-iosGreen hover:scale-110 flex items-center justify-center shadow-lg shadow-green-900/50 transition animate-bounce-slight text-white"><i data-lucide="phone" class="w-8 h-8 fill-current"></i></button>
                    <span class="text-xs font-medium text-green-400">Annehmen</span>
                </div>
            </div>
        </div>
    </div>

    <div id="newGroupModal" class="hidden fixed inset-0 z-[100] glass-modal flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-wa-panel w-full max-w-sm rounded-[28px] p-8 shadow-2xl transform transition-all scale-100 border dark:border-gray-700 animate-scale-in">
            <h3 class="text-2xl font-black mb-6 dark:text-white">Neue Gruppe</h3>
            <input id="ng_name" type="text" class="w-full bg-gray-100 dark:bg-wa-dark p-4 rounded-xl outline-none mb-4 dark:text-white" placeholder="Gruppenname">
            <input id="ng_pass" type="password" class="w-full bg-gray-100 dark:bg-wa-dark p-4 rounded-xl outline-none mb-8 dark:text-white" placeholder="Passwort (Optional)">
            <div class="flex justify-end gap-3">
                <button onclick="window.toggleModal('newGroupModal')" class="px-6 py-2 text-gray-500 font-bold">Abbrechen</button>
                <button onclick="window.createGrp()" class="bg-wa-accent px-8 py-3 rounded-xl text-white font-bold">Erstellen</button>
            </div>
        </div>
    </div>

    <div id="joinGroupModal" class="hidden fixed inset-0 z-[100] glass-modal flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-wa-panel w-full max-w-sm rounded-[28px] p-8 shadow-2xl border dark:border-gray-700 animate-scale-in">
            <h3 class="text-2xl font-black mb-6 dark:text-white">Beitreten</h3>
            <input id="jg_id" type="text" placeholder="GRP-XXXXXXX" class="w-full bg-gray-100 dark:bg-wa-dark p-4 rounded-xl outline-none mb-4 uppercase font-mono text-center dark:text-white">
            <input id="jg_pass" type="password" placeholder="Passwort" class="w-full bg-gray-100 dark:bg-wa-dark p-4 rounded-xl outline-none mb-8 text-center dark:text-white">
            <div class="flex justify-end gap-3">
                <button onclick="window.toggleModal('joinGroupModal')" class="px-6 py-2 text-gray-500 font-bold">Abbrechen</button>
                <button onclick="window.joinGrp()" class="bg-wa-accent px-10 py-3 rounded-xl text-white font-bold">Join</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="hidden fixed inset-0 z-[100] glass-modal flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-wa-panel w-full max-w-sm rounded-[28px] p-8 shadow-2xl relative border dark:border-gray-700 animate-scale-in">
            <button onclick="window.toggleModal('loginModal')" class="absolute top-4 right-4 text-gray-400"><i data-lucide="x" class="w-5 h-5"></i></button>
            <h3 class="text-2xl font-black mb-8 text-center dark:text-white">Login</h3>
            <input id="login_id" type="text" placeholder="User ID" class="w-full bg-gray-100 dark:bg-wa-dark p-4 rounded-xl outline-none mb-4 font-mono text-center dark:text-white">
            <input id="login_pass" type="text" placeholder="Passwort" class="w-full bg-gray-100 dark:bg-wa-dark p-4 rounded-xl outline-none mb-8 font-mono text-center dark:text-white">
            <button onclick="window.recoverAccount()" class="w-full bg-wa-accent py-4 rounded-xl text-white font-black">Wiederherstellen</button>
        </div>
    </div>

    <div id="infoModal" class="hidden fixed inset-0 z-[100] glass-modal flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-wa-panel w-full max-w-md rounded-[32px] overflow-hidden shadow-2xl relative flex flex-col max-h-[85vh] animate-scale-in">
            <div class="h-40 bg-gradient-to-br from-wa-accent to-emerald-800 relative flex items-end p-6 shrink-0">
                <button onclick="window.toggleModal('infoModal')" class="absolute top-4 right-4 bg-black/20 text-white p-2 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
                <div id="infoAvaLarge" class="w-24 h-24 rounded-2xl bg-white/20 backdrop-blur-md border border-white/30 text-white flex items-center justify-center text-4xl font-black shadow-2xl translate-y-8">?</div>
            </div>
            <div class="p-6 pt-12 flex-1 overflow-y-auto custom-scrollbar">
                <h3 id="infoTit" class="text-2xl font-black mb-1 dark:text-white">Name</h3>
                <div id="infoBadge" class="inline-block px-3 py-1 rounded-full bg-wa-accent/10 text-wa-accent text-[10px] font-bold font-mono tracking-widest mb-6">ID: ---</div>
                <h4 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-4">Teilnehmer</h4>
                <div id="infoMemberList" class="space-y-3 mb-6"></div>
            </div>
            <div class="p-4 bg-gray-50 dark:bg-wa-dark border-t dark:border-gray-800 shrink-0">
                 <button onclick="window.leaveChat()" id="leaveBtn" class="w-full py-3 rounded-xl border border-red-500/30 text-red-500 font-bold hover:bg-red-500 hover:text-white transition flex items-center justify-center gap-2"><i data-lucide="log-out" class="w-4 h-4"></i> Chat verlassen</button>
            </div>
        </div>
    </div> 

    <script type="module" src="script.js"></script>
</body>
</html>
